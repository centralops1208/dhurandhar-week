<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dhurandhar Week â€“ AOM Leaderboard</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body{font-family:system-ui,Arial;margin:20px;background:#fafafa}
    h2{margin-bottom:10px}

    .top{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    input,select,button{
      padding:10px;border:1px solid #ddd;border-radius:10px;
      font-size:14px;background:#fff;
    }
    input{width:300px}
    button{cursor:pointer}
    button.active{border-color:#111;font-weight:700}
    .meta{margin-left:auto;font-size:13px;color:#555;display:flex;gap:12px}

    table{border-collapse:collapse;width:100%;background:#fff}
    th,td{border:1px solid #eee;padding:12px;text-align:left;vertical-align:middle}
    th{background:#f5f5f5;position:sticky;top:0}
    tr:hover{background:#f9f9f9}

    tr.gold{background:#fff8d1}
    tr.silver{background:#f3f5f7}
    tr.bronze{background:#ffe7d6}

    /* ===== AOM PHOTO + NAME ===== */
    .aomWrap{
      display:flex;
      align-items:center;
      gap:14px;
    }

    .aomPhotoBox{
      width:64px;
      height:64px;
      border:1px solid #ddd;
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fff;
    }

    .aomImg{
      width:48px;
      height:48px;
      border-radius:50%;
      object-fit:cover;
    }

    .aomName{
      font-weight:600;
      white-space:nowrap;
    }
  </style>
</head>

<body>
<h2>ðŸ”¥ Dhurandhar Week â€“ AOM Leaderboard</h2>

<div class="top">
  <input id="search" placeholder="Search AOM / Circleâ€¦" />
  <select id="circle">
    <option value="">All Circles</option>
  </select>

  <button id="btnAll" class="active">All</button>
  <button id="btn10">Top 10</button>
  <button id="btn50">Top 50</button>

  <div class="meta">
    <span id="count">Loadingâ€¦</span>
    <span id="updated">Last updated: â€”</span>
  </div>
</div>

<table id="table">
  <thead></thead>
  <tbody></tbody>
</table>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRUkfZBtB8_vCdr2eD5qh5GJWwuXyrvreI66slaXScut5SS118EUJnC671Pcy4ebpc_g9dZ3D3xpAO-/pub?gid=0&single=true&output=csv";

let rows=[], headers=[];
let sortCol=0;
let circleCol="";
let limitMode="all";

function toNum(v){
  const n = Number(String(v||"").replace('%','').replace(/,/g,''));
  return isNaN(n)?0:n;
}

function setActive(id){
  ["btnAll","btn10","btn50"].forEach(b=>{
    document.getElementById(b).classList.toggle("active",b===id);
  });
}

function setUpdated(){
  document.getElementById("updated").innerText =
    "Last updated: " + new Date().toLocaleString();
}

function getData(){
  const q=document.getElementById("search").value.toLowerCase();
  const c=document.getElementById("circle").value;

  let d=rows.filter(r=>
    (!q || Object.values(r).some(v=>String(v).toLowerCase().includes(q))) &&
    (!c || (circleCol && r[circleCol]===c))
  );

  d.sort((a,b)=>toNum(b[headers[sortCol]])-toNum(a[headers[sortCol]]));

  if(limitMode==="top10") d=d.slice(0,10);
  if(limitMode==="top50") d=d.slice(0,50);
  return d;
}

function render(){
  const data=getData();
  document.getElementById("count").innerText=`${data.length} shown`;
  const tbody=document.querySelector("tbody");
  tbody.innerHTML="";

  const photoCol=headers.find(h=>h.toLowerCase()==="photo");
  const aomCol=headers.find(h=>h.toLowerCase().includes("aom"));

  data.forEach((r,i)=>{
    const tr=document.createElement("tr");

    if(limitMode!=="all"){
      if(i<10) tr.classList.add("gold");
      else if(i<20) tr.classList.add("silver");
      else if(i<30) tr.classList.add("bronze");
    }

    headers.forEach(h=>{
      if(h.toLowerCase()==="photo") return;

      const td=document.createElement("td");
      const val=r[h]||"";

      if(h===aomCol && photoCol){
        const wrap=document.createElement("div");
        wrap.className="aomWrap";

        const box=document.createElement("div");
        box.className="aomPhotoBox";

        const url=String(r[photoCol]||"").trim();
        if(url){
          const img=document.createElement("img");
          img.className="aomImg";
          img.src=url;
          img.loading="lazy";
          box.appendChild(img);
        }
        wrap.appendChild(box);

        const name=document.createElement("span");
        name.className="aomName";
        name.textContent=val;
        wrap.appendChild(name);

        td.appendChild(wrap);
      }
      else if(h.toLowerCase().includes("ranking")){
        if(i===0) td.textContent=`ðŸ¥‡ ${val}`;
        else if(i===1) td.textContent=`ðŸ¥ˆ ${val}`;
        else if(i===2) td.textContent=`ðŸ¥‰ ${val}`;
        else td.textContent=val;
      }
      else td.textContent=val;

      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });
}

function buildHeader(){
  const tr=document.createElement("tr");
  headers.forEach((h,i)=>{
    if(h.toLowerCase()==="photo") return;
    c
